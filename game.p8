pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
  game = {}
  start_game()
end

function _update()
  game.update()
end

function _draw()
  game.draw()
end

function start_game()
  game.update = game_update
  game.draw = game_draw

  #include global_variables.lua
  #include blink.lua
  #include camera.lua
  #include fruits.lua
  #include deck.lua
  #include selected_card.lua
  #include lawn.lua

  selected_card:place_starting_card()
end

function game_update() 
  selected_card:update()
  adjust_selected_card_or_camera_position(selected_card,cam)
  camera(cam.x0,cam.y0)
  blink:update()
end

function game_draw()
  cls(5)
  
  lawn:draw()

  for fruit in all(planted_fruits) do
    pal(spritesheet_fruit_color,fruit.color)
    spr(fruit:sprite(),fruit.x,fruit.y,fruit_sprite_width,fruit_sprite_height)
  end
  selected_card:draw()
  -- print('card:'..selected_card.card_number..'/'..deck.count_after_first_card_placement,cam.x0 + 1,cam.y0 + 1,7)
  -- print('score:'..score,cam.x0 + 1,cam.y0 + 7,7)
end

function game_over()
  game.update = game_over_update
  game.draw = game_over_draw
end

function game_over_update()
  if btnp(5) then start_game() end
end

function game_over_draw()
  cls()
  print('game over',cam.x0 + 1,cam.y0 + 1,7)
  print('final score:'..score,cam.x0 + 1,cam.y0 + 7,7)
  print('press x to replay',cam.x0 + 1,cam.y0 + 13,7)
end

#include shared_functions.lua

__gfx__
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333333333311113333330000000000000000000000000000000000000000000000000000000000000000
333333333333333333333333333333333333333113333333333311bbbb1133330000000000000000000000000000000000000000000000000000000000000000
333333333333333333333333333333333333331bb13333333331bbbbbbbb13330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333331111333333333331bbbb133333331bb78bbbbbb1330000000000000000000000000000000000000000000000000000000000000000
3333333333333333333331bbbb13333333331b78bbb1333331bbb88bbbbbbb130000000000000000000000000000000000000000000000000000000000000000
333333333333333333331b78bbb133333331bb88bbbb133331bbbbbbbb3bb3130000000000000000000000000000000000000000000000000000000000000000
33333337833333333331bb88bb331333331bbbbbbbb3313331bbbbbbb33b33130000000000000000000000000000000000000000000000000000000000000000
33333338833333333331bbbbbbb31333331bbbbbbbbb313331b3bbbbbbbbb3130000000000000000000000000000000000000000000000000000000000000000
33333311113133333331bbbb3b3313333313bbbb3bb331333133bbbbb3bb33130000000000000000000000000000000000000000000000000000000000000000
333333333333333333311bbbb331133333133b3bb333313333133bbb333331330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333113333113333333133333333133333313333333313330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333313333331333333331333333133330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333144244224133333332422224233330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333333122424244221330000000000000000000000000000000000000000000000000000000000000000
33333333333333333333333333333333333333333333333333333333333333330000000000000000000000000000000000000000000000000000000000000000
