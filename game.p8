pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
function _init()
  game = {}
  start_game()
end

function _update()
  game.update()
end

function _draw()
  game.draw()
end

function start_game()
  game.update = game_update
  game.draw = game_draw

  #include global_variables.lua
  #include blink.lua
  #include camera.lua
  #include fruits.lua
  #include deck.lua
  #include selected_card.lua
  #include lawn.lua

  selected_card:place_starting_card()
end

function game_update() 
  selected_card:update()
  adjust_selected_card_or_camera_position(selected_card,cam)
  camera(cam.x0,cam.y0)
  blink:update()
end

function game_draw()
  cls(5)
  
  lawn:draw()

  for fruit in all(planted_fruits) do fruit:draw() end
  selected_card:draw()
  -- print('card:'..selected_card.card_number..'/'..deck.count_after_first_card_placement,cam.x0 + 1,cam.y0 + 1,7)
  -- print('score:'..score,cam.x0 + 1,cam.y0 + 7,7)
end

function game_over()
  game.update = game_over_update
  game.draw = game_over_draw
end

function game_over_update()
  if btnp(5) then start_game() end
end

function game_over_draw()
  cls()
  print('game over',cam.x0 + 1,cam.y0 + 1,7)
  print('final score:'..score,cam.x0 + 1,cam.y0 + 7,7)
  print('press x to replay',cam.x0 + 1,cam.y0 + 13,7)
end

#include shared_functions.lua

__gfx__
0001111000144244224100001111000000000bbee000000000000cc000000000000000000000ee0eee0000eeeeeeeee000000000000000000003000000000000
001bbbb10001333333100001bb11100000000bbbe00000000000cccc000000000000000000eeee0eee0000eeeeeeeeee00000000000003330033303000000000
01b78bbb1013333333310001bb1330000000eeeee30000000000bbcc00000000000000000eeeee0eee0000eeeeeeeeeee0000000000033333333333300000000
1bb88bb33133b3bb33331111111111100000eeee330000000000bbcc0000000000000000eeeeee0eee0000eee00000eeee00000000033333bb33bb3000000000
1bbbbbbb313bbbb3bb331000eeeeee0000eeeeeeeeee0000000cccccc000000000000000eeeee00eee0000eee000000eee000000303b3bbbbbbbbb3300000000
1bbbb3b331bbbbbbbbb3100eeeeeeee00eeeeeeeeeeee000000cccc33000000000000000eeee000eee0000eee000000eee000003333bbb7bbbbbbb3b30300000
11bbbb3311bbbbbbbb3310eeeeeeeeee00000cccccc00000000cccccc000000000000000eee0000eee0000eee00000eeee000003333b7777bbbbbbbbb3330000
01133331101bb88bbbb100eeeeeeeeee000cccccccccc00000cccccccc00000000000000eeeeee0eeeeee0eeeeeeeeeee000030b3bb7777bbbbbb33b33330030
078000000001b78bbb100eeeeeeeeeeee0cccccccccccc000cccccccccc0000000000000eeeeee0eeeeee0eeeeeeeeee0003333bbb7b7bbbbbbbbb3333333333
0880000000001bbbb1000000000eeee00000cccccccccc00cccccccccccc000000000000eeeeee0eeeeee0eeeeeeeee0003333bbb777bbbbbbb3b33333333330
11110100000001bb1000000000eeeeee00cccccccccccccc00000bbcc000000000000000eee0000eee0000eeeeee000000033bbbbb7bbbbbbb33333333b33330
00000111100000110000000000eeeeee000000cccc00000000000bbcc000000000000000eee0000eee0000eeeeeee000000333bbbbbbbbbbb33333333bbb3330
00011bbbb1100000111111000eeeeeeee0000cccccc0000000000bbcc000000000000000eee0000eee0000eeeeeeee00000033bbbb333b3b333333333bb33300
001bbbbbbbb10001111111100eeeeeeee000cccccccc00000000cbbc3300000000000000eee0000eee0000eee0eeeee00003333bbbb3333333bbbbb3bbbb3300
01bb78bbbbbb100111111110eeeeeeeeee00cccccccc00000000cccc3300000000000000eee0000eee0000eee00eeeee003333333b33333b3bbbbbbbbbbb3300
1bbb88bbbbbbb10111111110eeeeeeeeee00cccccccc0000000cccccccc0000000000000eee0000eee0000eee000eeeee0033333333333bbbbb7bbbbbbbb3300
1bbbbbbbb3bb311111111111000000000000cccccccc000000cccccccccc000000000000eee0000eee0000eee0000eeeee0333333333333bb7777bbbbbbb3300
1bbbbbbb33b331011110000eeee000000000cccccccc0000cccccccccccccc0000000000eee0000eee0000eee00000eeee3333333333333b7777bbbbbbb33300
1b3bbbbbbbbb31111111000eeee00000000cccccccccc00cccc000000000000000000000eee0000eee0000eee000000eee033333b333b33bb7bbbbbbbb333300
133bbbbb3bb331111111000eeee00000000cccccccccc00cccc000000000000000000000eee0000eee0000eee0000000ee33333bbb7bbb33bbbbbbbbb3333300
0133bbb333331011111100eeeeee0000000000000000000cccc00000000000000000000000000000000000000000000000030333b777bb333bbbbbbbbb333330
0013333333310011111100eeeeee0000000000000000000cccc00000000000000000000000000000000000000000000000000033bb7bbbbb33bbb333b3333300
0001333333100011111100eeeeee000000000000000000cccccc00000000000000000eeeeeeee000000000eeee000000000ee3333bbbbbbbb33b333333333330
0002422224200011111100eeeeee000000000000000000cccccc00000000000000000eeeeeeeeee00000eeeeeeee00000eeee33333bbbbb33333333333330300
012242424422101111110eeeeeeee00000000000000000cccccc00000000000000000eeeeeeeeeee000eeeeeeeeee000eeeee03003bbb3333332333333330000
000111100000001111110eeeeeeee000beee0000000000cccccc00000000000000000eeeeeeeeeeee0eeeeeeeeeeee0eeeeee000333b33333322233333300000
001111110000001111110eeeeeeee000bbee000000000cccccccc0000000000000000eee0000eeeee0eeeee000eeee0eeeee0000033333233222333330000000
111111111100001111000eeeeeeee00eeeeee00000000cccccccc0000000000000000eee00000eeee0eeee00000eee0eeee00000033332224223300333000000
00111111110001b111100eeeeeeee00eeeeee00000000cccccccc0000000000000000eee000000eee0eee0000000000eee000000003333244200000030000000
1111111111110111111000000000000eeeee300000000cccccccc0000000000000000eee000000eee0eee0000000000eee000000000000444200000000000000
000000000000011111300000000000eeeeeeee0000000cccccccc0000000000000000eee000000eee0eee0000000000eee000000000000444200000000000000
00000000000011111111000000000eeeeeeeeee000000cccccccc0000000000000000eee000000eee0eee0000000000eee000000000000444400000000000000
